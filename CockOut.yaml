openapi: 3.0.1
info:
  title: CockOut API
  version: 0.1.0
  license:
    name: MIT license
    url: 'https://opensource.org/licenses/MIT'
  contact:
    name: API Support
    url: https://github.com/OpenAlcoholics/CockBot-OpenAPI/issues
    email: felixclemensgail@gmail.com
paths:
  /version:
    get:
      tags:
        - setup
      summary: CockOut version
      description: The version of the CockOut implementation.
      operationId: getVersion
      security: []
      responses:
        200:
          description: Information about the implemented API version and the implementation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Version'
  /ingredients:
    put:
      tags:
        - setup
        - ingredient
      summary: Assign ingredients to pumps. Overrides an existing list
      description: >
        Accepts a list of ingredients, ordered after usage in cocktails, and assigns them to pumps
      operationId: assignIngredients
      requestBody:
          required: true
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ingredient'
      responses:
        200:
          description: List of Position with assigned ingredients
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Position'
        422:
          description: Not enough pumps available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
    get:
      tags:
        - setup
        - ingredient
      summary: Get Pump Configuration
      operationId: getIngredients
      responses:
        200:
          description: List of Position with assigned ingredients
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Position'
  /ingredient/{position}:
    parameters:
      - name: position
        description: The position of a pump.
        in: path
        required: true
        schema:
          type: integer
    put:
      tags:
        - setup
        - ingredient
      summary: Replace the ingredient at a definit position
      operationId: assignIngredient
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Ingredient'
      responses:
        200:
          description: Position successfully updated
          content:
            application/json:
                schema:
                  $ref: '#/components/schemas/Position'
        404:
          description: Position out of range
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
    delete:
      tags:
        - setup
        - ingredient
      summary: Delete a pump assignment
      operationId: deleteIngredient
      responses:
        200:
          description: successfully deleted pump assignment
        404:
          description: Position out of range
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
    get:
      tags:
        - setup
        - ingredient
      summary: Get Information about a single position.
      responses:
        200:
          description: Information about a specific position
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Position'
        404:
          description: Position out of range
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
  /cocktail:
    post:
      tags:
        - use
        - cocktail
      summary: Mix a cocktail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Cocktail'
      responses:
        200:
          description: Cocktail is being processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'

  /status:
    get:
      tags:
      - use
      - status
      summary: Get all current tasks
      responses:
        200:
          description: List of current tasks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Task'
  /status/{reference}:
    parameters:
      - name: reference
        description: Reference to a task.
        in: path
        required: true
        schema:
          type: string

    get:
      tags:
      - use
      - status
      summary: Information about a task
      responses:
        200:
          description: Task information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Task'
components:
  schemas:
    Version:
      description: Describes the server version.
      type: object
      required:
      - apiVersion
      - implementation
      properties:
        apiVersion:
          example: 1.0.0
          description: The API version.
          type: string
        implementation:
          $ref: "#/components/schemas/ImplementationInfo"
    ImplementationInfo:
      description: Information about the implementation serving the API.
      type: object
      required:
      - name
      - version
      properties:
        name:
          description: The name of the server implementation.
          example: CockOut
          type: string
        version:
          description: The version of the implementation.
          example: 1.0.0
          type: string
    Position:
      description: Information about a pump position
      type: object
      required:
      - position
      properties:
        position:
          description: Position of the pump
          example: 42
          type: integer
        throughput:
          description: estimated throughput of the pump in ml/min
          example: 200
          type: integer
        ingredient:
          $ref: '#/components/schemas/Ingredient'

    Ingredient:
      description: A liquid Igredient that can be assigned to a pump
      type: object
      required:
        - ingredientId
      properties:
        ingredientId:
          description: Ingredient ID of the ingredient
          type: integer
          example: 42
        amount:
          description: Amount of liquid in the container (in ml). Defaults to 750ml.
          type: integer
          example: 750
    Task:
      description: A task, created when a cocktail is being processed
      type: object
      required:
        - reference
        - status
        - completionTime
      properties:
        reference:
          description: A UUID to reference the taks
          type: string
          example: c4c0a6b7-6abc-4db9-a3c5-3b278fcd5107
        status:
          description: Status of the task
          type: string
          enum:
            - waiting
            - in_progress
            - completed
            - failed
          example: completed
        completionTime:
          description: Estimated system time at completion
          type: integer
          example: 1539981501224
        progress:
          description: Progress of the cocktail preparation. Only available during 'in_progress' status.
          type: integer
          minimum: 0
          maximum: 100
    Cocktail:
      description: A Cocktail recipe
      type: object
      required:
        - id
        - ingredients
        - size
      properties:
        id:
          description: A Cocktail ID in order to reconstruct the request
          type: integer
          example: 42
        ingredients:
          description: >
            A list of ingredient ID lists. If a list contains multiple ingredient IDs,
            they can be poured simultaneously.
          type: array
          items:
            type: array
            items:
              $ref: "#/components/schemas/CocktailIngredient"
        size:
          description: Cocktail size in milliliters
          type: integer
          example: 400
    CocktailIngredient:
      description: The relation of an ingredient to a cocktail.
      type: object
      required:
        - ingredientId
        - share
      properties:
        ingredientId:
          description: The ingredient ID.
          example: 123
          type: integer
        share:
          description: The share (in percent) of the ingredient in a cocktail.
          example: 40
          type: integer
          format: int32
          minimum: 0
          maximum: 100
    ErrorMessage:
      description: Error Mesage to the caller.
      type: object
      required:
        - message
      properties:
        message:
          example: Unproccessable. More ingredients than pumps
          type: string
